# Multi-Source Pipeline Configuration
# This example demonstrates a complex pipeline with multiple sources,
# different bootstrap providers, and multiple queries and reactions.

server_core:
  id: "multi-source-pipeline"
  # Global default priority queue capacity for all queries and reactions
  # Default is 10000 if not specified
  priority_queue_capacity: 20000
  # Global default dispatch buffer capacity for sources and queries
  # Default is 1000 if not specified
  dispatch_buffer_capacity: 2000

sources:
  # Mock sensor data with script file bootstrap
  - id: "sensor-stream"
    source_type: "mock"
    auto_start: true
    # Mock source configuration (typed)
    data_type: "sensor"
    interval_ms: 1000
    bootstrap_provider:
      type: scriptfile
      file_paths:
        - "examples/data/sensor_data.jsonl"

  # User data from script file
  - id: "user-data"
    source_type: "mock"
    auto_start: true
    # Mock source configuration (typed)
    data_type: "person"
    interval_ms: 10000
    bootstrap_provider:
      type: scriptfile
      file_paths:
        - "/data/users.jsonl"

  # Event stream without bootstrap
  - id: "event-stream"
    source_type: "mock"
    auto_start: true
    # Mock source configuration (typed)
    data_type: "event"
    interval_ms: 2000

queries:
  # Monitor high temperature sensors
  - id: "high-temp-alert"
    query: "MATCH (s:SensorReading) WHERE s.temperature > 80 RETURN s"
    query_language: "cypher"
    sources: ["sensor-stream"]
    auto_start: true
    # High-volume query with larger priority queue
    priority_queue_capacity: 50000

  # Monitor user activity patterns
  - id: "user-activity"
    query: "MATCH (u:Person)-[:TRIGGERED]->(e:Event) RETURN u, e"
    query_language: "cypher"
    sources: ["user-data", "event-stream"]
    auto_start: true

  # Aggregate sensor data
  - id: "sensor-summary"
    query: "MATCH (s:SensorReading) RETURN s.location, avg(s.temperature) as avg_temp"
    query_language: "cypher"
    sources: ["sensor-stream"]
    auto_start: true

reactions:
  # Critical alerts to webhook
  - id: "critical-alert-webhook"
    reaction_type: "log"
    queries: ["high-temp-alert"]
    auto_start: true
    # Critical reaction with larger priority queue for reliability
    priority_queue_capacity: 100000
    # Log reaction configuration (typed)
    log_level: "warn"

  # User activity to analytics
  - id: "activity-analytics"
    reaction_type: "log"
    queries: ["user-activity"]
    auto_start: true
    # Log reaction configuration (typed)
    log_level: "info"

  # Sensor summary to dashboard
  - id: "dashboard-feed"
    reaction_type: "log"
    queries: ["sensor-summary"]
    auto_start: true
    # Log reaction configuration (typed)
    log_level: "debug"