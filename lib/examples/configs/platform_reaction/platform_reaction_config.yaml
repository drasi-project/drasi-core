# Platform Reaction Configuration Example
# This demonstrates how to configure the platform reaction to publish
# query results to Redis Streams in Dapr CloudEvent format

server_core:
  id: "platform-reaction-example"
  priority_queue_capacity: 10000
  dispatch_buffer_capacity: 1000

# Data source - using mock for demonstration
sources:
  - id: "sensor-data"
    source_type: "mock"
    auto_start: true
    # Mock source configuration (typed)
    data_type: "sensor"
    interval_ms: 2000

# Continuous query
queries:
  - id: "high-temperature-alert"
    query: "MATCH (s:Sensor) WHERE s.temperature > 75 RETURN s"
    sources: ["sensor-data"]
    auto_start: true

# Platform reaction - publishes to Redis Stream
reactions:
  - id: "platform-publisher"
    reaction_type: "platform"
    queries: ["high-temperature-alert"]
    auto_start: true
    # Platform reaction configuration (typed)
    # Required: Redis connection URL
    redis_url: "redis://localhost:6379"

    # Optional: Pub/sub name for Dapr CloudEvent (default: "drasi-pubsub")
    pubsub_name: "drasi-pubsub"

    # Optional: Source name for CloudEvent (default: "drasi-core")
    source_name: "drasi-core"

    # Optional: Maximum stream length for trimming (default: unlimited)
    # Uses Redis MAXLEN with approximate trimming (~)
    max_stream_length: 10000

    # Optional: Emit control events for lifecycle (default: true)
    # Control events include: BootstrapStarted, BootstrapCompleted, Running, Stopped, Deleted
    emit_control_events: true

# Stream Naming Convention:
# Results are published to streams named: {query-id}-results
# Example: high-temperature-alert-results

# CloudEvent Format:
# {
#   "data": {
#     "kind": "change",
#     "queryId": "high-temperature-alert",
#     "sequence": 1,
#     "sourceTimeMs": 1609459200000,
#     "addedResults": [...],
#     "updatedResults": [...],
#     "deletedResults": [...]
#   },
#   "datacontenttype": "application/json",
#   "id": "uuid-v4",
#   "pubsubname": "drasi-pubsub",
#   "source": "drasi-core",
#   "specversion": "1.0",
#   "time": "2021-01-01T00:00:00.000Z",
#   "topic": "high-temperature-alert-results",
#   "type": "com.dapr.event.sent"
# }
